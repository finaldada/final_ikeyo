<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="Custom">

<select id="getCustomList" parameterType="kh.com.a.model.NoticeParam"
	resultType="kh.com.a.model.CustomDto">
	SELECT CUST_SEQ, ID, REF, STEP, DEPTH, TITLE, CONTENT, 
		WDATE, PARENT, DEL, LOCK_, READCOUNT, FILENAME 
	FROM 
		(SELECT ROW_NUMBER() OVER(ORDER BY REF DESC, STEP ASC)AS RNUM,
			CUST_SEQ, ID, REF, STEP, DEPTH, TITLE, CONTENT, 
			WDATE, PARENT, DEL, LOCK_, READCOUNT, FILENAME 
		 FROM CUSTOM 
		 WHERE 1=1 
		 <if test="s_category != null and s_category != ''
		 		and s_keyword != null and s_keyword != ''">
		 	
		 	<if test="s_category == 'title'">
		 		AND TITLE LIKE '%'||#{s_keyword}||'%'
		 	</if>
		 	<if test="s_category == 'contents'">
		 		AND CONTENT LIKE '%'||#{s_keyword}||'%'
		 	</if>
		 	<if test="s_category == 'writer'">
	 			AND ID LIKE '%'||#{s_keyword}||'%'
	 		</if>
		 </if>
		) A
	WHERE RNUM BETWEEN ${start} AND ${end}
</select>

<select id="getCustomCount" parameterType="kh.com.a.model.NoticeParam"
	resultType="java.lang.Integer">
	SELECT NVL(COUNT(*), 0) AS CNT
	FROM CUSTOM 
	WHERE 1=1
	<if test="s_category != null and s_category != ''
		 		and s_keyword != null and s_keyword != ''">
		 	
	 	<if test="s_category == 'title'">
	 		AND TITLE LIKE '%'||#{s_keyword}||'%'
	 	</if>
	 	<if test="s_category == 'contents'">
	 		AND CONTENT LIKE '%'||#{s_keyword}||'%'
	 	</if>
	 	<if test="s_category == 'writer'">
 			AND ID LIKE '%'||#{s_keyword}||'%'
 		</if>
	 </if>
</select>

<insert id="customupload" parameterType="kh.com.a.model.CustomDto">
	INSERT INTO CUSTOM(CUST_SEQ, ID, REF, STEP, DEPTH, TITLE, CONTENT, WDATE, 
					PARENT, DEL, LOCK_, READCOUNT, FILENAME)
	VALUES(SEQ_CUST.NEXTVAL, #{id}, (SELECT NVL(MAX(REF), 0)+1 FROM CUSTOM), 0, 0, 
					#{title}, #{content}, SYSDATE, 
					0, 0, #{lock_}, 0, #{filename})
</insert>





</mapper>